# zookeeper

### 如何实现分布式锁

```
1.临时顺序节点
2.顺序最靠前的获取锁
3.Client1得到了锁，Client2监听Lock1，Client3监听Lock2，形成了一个等待队列
```



### leader的选举过程

```
假定Zookeeper由5台机器组成，SID（服务器唯一标识）分别为1、2、3、4、5，ZXID（事物id）分别为9、9、9、8、8，并且此时SID为2的机器是Leader机器，某一时刻，1、2所在机器出现故障，因此集群开始进行Leader选举。在第一次投票时，每台机器都会将自己作为投票对象，于是SID为3、4、5的机器投票情况分别为(3, 9)，(4, 8)， (5, 8)；第二次投票时，每个服务都向其它服务发送自己的选票，每个服务都会先比较ZXID，如果小于其它服务ZXID更新自己选票，如果大于则不更新，如果相等然后再比较SID，如果小于其它服务的则更新自己选票，如果大于则不更新；更新选票的服务会把最新选票发送给其它服务，超过半数服务支持的服务就是leader;所以第三个服务是leader
```



### zk 属于 cap的哪种，a如何体现

```
属于cp,牺牲可用性；master在宕机后选举Leader期间不提供服务
```

